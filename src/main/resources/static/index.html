<!-- src/main/resources/static/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Cache Analytics Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .hit { color: #4CAF50; font-weight: bold; }
        .miss { color: #f44336; font-weight: bold; }
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
    </style>
</head>
<body>
<div class="dashboard">
    <h1>üöÄ Cache Performance Dashboard</h1>
    <p>Real-time monitoring of your caching proxy performance</p>

    <button class="refresh-btn" onclick="loadStats()">üîÑ Refresh Data</button>

    <div class="metrics">
        <div class="metric-card">
            <h3>Hit Rate</h3>
            <div id="hitRate" class="hit">Loading...</div>
        </div>
        <div class="metric-card">
            <h3>Total Requests</h3>
            <div id="totalRequests">Loading...</div>
        </div>
        <div class="metric-card">
            <h3>Cache Hits</h3>
            <div id="totalHits" class="hit">Loading...</div>
        </div>
        <div class="metric-card">
            <h3>Cache Misses</h3>
            <div id="totalMisses" class="miss">Loading...</div>
        </div>
    </div>

    <div id="endpointStats">
        <h3>üìä Endpoint Performance</h3>
        <div id="endpointsList">Loading endpoint data...</div>
    </div>

    <div style="margin-top: 30px;">
        <h3>‚ö° Quick Actions</h3>
        <button class="refresh-btn" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
        <button class="refresh-btn" onclick="resetStats()">üìä Reset Statistics</button>
    </div>
</div>

<script>
    // Load stats when page opens
    document.addEventListener('DOMContentLoaded', loadStats);

    async function loadStats() {
        try {
            const response = await fetch('/proxy/cache/stats/detailed');
            const data = await response.json();

            // Update overall stats
            document.getElementById('hitRate').textContent = data.overall.hitRate;
            document.getElementById('totalRequests').textContent = data.overall.totalRequests;
            document.getElementById('totalHits').textContent = data.overall.totalHits;
            document.getElementById('totalMisses').textContent = data.overall.totalMisses;

            // Update endpoint stats
            const endpointsList = document.getElementById('endpointsList');
            endpointsList.innerHTML = '';

            for (const [endpoint, stats] of Object.entries(data.endpoints)) {
                const endpointDiv = document.createElement('div');
                endpointDiv.style.cssText = 'padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px;';
                endpointDiv.innerHTML = `
                        <strong>${endpoint}</strong>:
                        <span class="hit">${stats.hits} hits</span> |
                        <span class="miss">${stats.misses} misses</span> |
                        <span class="hit">${stats.hitRate} hit rate</span>
                    `;
                endpointsList.appendChild(endpointDiv);
            }

        } catch (error) {
            console.error('Error loading stats:', error);
            document.getElementById('hitRate').textContent = 'Error loading data';
        }
    }

    async function clearCache() {
        if (confirm('Are you sure you want to clear all cache?')) {
            await fetch('/proxy/cache/clear', { method: 'POST' });
            alert('Cache cleared successfully!');
            loadStats(); // Refresh the dashboard
        }
    }

    async function resetStats() {
        if (confirm('Reset all statistics?')) {
            await fetch('/proxy/cache/stats/reset', { method: 'POST' });
            alert('Statistics reset!');
            loadStats(); // Refresh the dashboard
        }
    }

    // Auto-refresh every 10 seconds
    setInterval(loadStats, 10000);
</script>
</body>
</html>